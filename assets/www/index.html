<html>
	<head>
		<meta name="viewport" content="width=device-width, initial-scale=1">
		<link rel="stylesheet" href="http://code.jquery.com/mobile/1.3.2/jquery.mobile-1.3.2.min.css" />
		<link href="./css/bootstrap.css" rel="stylesheet">
		<link href="./css/bootstrap-responsive.css" rel="stylesheet">
		
		<script src="http://code.jquery.com/jquery-1.9.1.min.js"></script>
		<script src="http://code.jquery.com/mobile/1.3.2/jquery.mobile-1.3.2.min.js"></script>
	</head>
		<body style="overflow:hidden" onload="onDeviceReady()">
		
		<style type="text/css">
		html {height:100%}
		body {height:100%; margin:0; padding:0}
		#map_canvas {height:100%; width:100%}
		</style>
	<script src="http://code.jquery.com/jquery-latest.js"></script>    
<script type="text/javascript">  

        var options = { timeout: 30000 };
        var watchID = navigator.geolocation.watchPosition(initialize, onError, options);

var map; // กำหนดตัวแปร map ไว้ด้านนอกฟังก์ชัน เพื่อให้สามารถเรียกใช้งาน จากส่วนอื่นได้  
var GGM; // กำหนดตัวแปร GGM ไว้เก็บ google.maps Object จะได้เรียกใช้งานได้ง่ายขึ้น  
var arr_path=[]; // กำหนดตัวแปรสำหรับเก็บค่าอาเรย์ ตำแหน่ง path  
var makePolyline; // กำหนดตัวแปร ฟังก์ชั่น สร้างเส้น polylines  
var objPolylines=[]; // กำหนดตัวแปรสำหรับเก็บค่า object ของ polylines  
function initialize(position) { // ฟังก์ชันแสดงแผนที่  
    GGM=new Object(google.maps); // เก็บตัวแปร google.maps Object ไว้ในตัวแปร GGM  
    // กำหนดจุดเริ่มต้นของแผนที่  
    var my_Latlng  =  new GGM.LatLng(position.coords.latitude,position.coords.longitude); 
    var my_mapTypeId=GGM.MapTypeId.ROADMAP; // กำหนดรูปแบบแผนที่ที่แสดง  
    // กำหนด DOM object ที่จะเอาแผนที่ไปแสดง ที่นี้คือ div id=map_canvas  
    var my_DivObj=$("#map_canvas")[0];   
    // กำหนด Option ของแผนที่  
    var myOptions = {  
        zoom: 16, // กำหนดขนาดการ zoom  
        center: my_Latlng , // กำหนดจุดกึ่งกลาง  
        mapTypeId:my_mapTypeId // กำหนดรูปแบบแผนที่  
    };  
    map = new GGM.Map(my_DivObj,myOptions);// สร้างแผนที่และเก็บตัวแปรไว้ในชื่อ map  
      
    var my_Marker = new GGM.Marker({ // สร้างตัว marker  
        position: my_Latlng,  // กำหนดไว้ที่เดียวกับจุดกึ่งกลาง  
        map: map, // กำหนดว่า marker นี้ใช้กับแผนที่ชื่อ instance ว่า map  
        draggable:false, // กำหนดให้สามารถลากตัว marker นี้ได้  
        title:"คลิกลากเพื่อหาตำแหน่งจุดที่ต้องการ!" // แสดง title เมื่อเอาเมาส์มาอยู่เหนือ  
    });  
    
      
    // กำหนด event ให้กับตัว marker เมื่อสิ้นสุดการลากตัว marker ให้ทำงานอะไร  
    GGM.event.addListener(map, "bounds_changed", function() {  
        var my_Point = my_Marker.getPosition(my_Latlng);  // หาตำแหน่งของตัว marker เมื่อกดลากแล้วปล่อย  
        arr_path.push(my_Point); // เพิ่มค่าตำแหน่ง จากตัว marker ตำแหน่งล่าสุด  
        map.panTo(my_Point);  // ให้แผนที่แสดงไปที่ตัว marker ล่าสุด  
                  
        makePolyline(arr_path); // ส่งค่าตำแหน่งใน array ไปสร้างเส้น polylines ในแผนที่  
//      console.log(arr_path);  
    });       
  
    // กำหนด event ให้กับตัวแผนที่ เมื่อมีการเปลี่ยนแปลงการ zoom  
    GGM.event.addListener(map, "zoom_changed", function() {  
        $("#zoom_value").val(map.getZoom()); // เอาขนาด zoom ของแผนที่แสดงใน textbox id=zoom_value    
    });  
}  

function onError(error) {
        alert('code: '    + error.code    + '\n' +
              'message: ' + error.message + '\n');
    }
  
makePolyline=function(arr_path){  
//  console.log(arr_path.length);  
    var i=arr_path.length-1;  
    objPolylines[i] = new GGM.Polyline({ // กำหนดรูปแบบของเส้น polylines  
        path: arr_path,// array ตำแหน่งที่เก็บค่า lat,lon  
        strokeColor: "#FF0000", // สี  
        strokeOpacity: 1.0, // ความโปร่งใส  
        strokeWeight: 2 //ความหน้าของเส้น  
    });   
    objPolylines[i].setMap(map);    // สร้างเส้น polylines ในแผนที่  
//  console.log(arr_path);  
//  console.log(objPolylines);  
}  
clearMapPolylines=function(){  
    arr_path=[];      
    for(i=0;i<objPolylines.length;i++){  
//      console.log(i);  
        objPolylines[i].setMap(null);  
    }  
  
//  console.log(arr_path);  
}  
$(function(){  
    // โหลด สคริป google map api เมื่อเว็บโหลดเรียบร้อยแล้ว  
    // ค่าตัวแปร ที่ส่งไปในไฟล์ google map api  
    // v=3.2&sensor=false&language=th&callback=initialize  
    //  v เวอร์ชัน่ 3.2  
    //  sensor กำหนดให้สามารถแสดงตำแหน่งทำเปิดแผนที่อยู่ได้ เหมาะสำหรับมือถือ ปกติใช้ false  
    //  language ภาษา th ,en เป็นต้น  
    //  callback ให้เรียกใช้ฟังก์ชันแสดง แผนที่ initialize  
    $("<script/>", {  
      "type": "text/javascript",  
      src: "http://maps.google.com/maps/api/js?v=3.2&sensor=false&language=th&callback=initialize"  
    }).appendTo("body");      
});  
</script>
		
		
		<div data-role="page" id="home" >
			<div data-role="header">
				<h1>Exercise Healthy</h1>
			</div>
			
			<div data-role="header" align="center" data-position="fixed"></div><br>
			<!-- <script type="text/javascript" charset="utf-8" src="cordova-2.5.0.js"></script> -->
			<script type="text/javascript" charset="utf-8" src="cordova-2.5.0.js"></script>
			<script type="text/javascript" src="https://maps.googleapis.com/maps/api/js?sensor=false"></script>
			<!-- CSS Style Sheet -->
			<link rel="stylesheet" href="./css/jquery.mobile-1.3.2.css">
			<link rel="stylesheet" href="./css/jquery.mobile.structure-1.3.2.css">

		
		
			<!--<style type="text/css">
			html {height:100%}
			body {height:100%; margin:0; padding:0}
			#map_canvas {height:100%; width:100%}
			</style>-->
				<table border="0" cellspacing="0" cellpadding="0" align="CENTER" >
					<tr>
						<td colspan="1" width="330" height="350">
							<div id="map_canvas" align="center"></div><br>
						</td>
					</tr>

				</table>	
				<table border="0"  cellspacing="0"cellpadding="0" align="center">
					<tr>
						<td colspan="2" width="157" height="10">
							Distance<h1 id="dist" style="font-size:20px;margin:40px;">0.0</h1>
						</td>
						<td colspan="2" width="157" height="10">
							Time<h1 id="timer" style="font-size:20px;margin:40px;">00:00:00</h1>
						</td>	
					</tr>	
				<table>		
				<center>
					<button type="button" id="btn-start-stop" class="btn btn-large btn-success" style="width:100%;height:50px;">Start</button>
					<button type="button" id="btn-pause" class="btn btn-large btn-inverse" style="width:100%;height:50px;">Pause</button>
				</center>
			<div data-role="footer" data-position="fixed" class="nav-glyphish-example">
				<div data-role="navbar" class="nav-glyphish-example" data-grid="c">
					<ul>
						<li><a href="#" id="home" >Home</a></li>
						<li><a href="#" id="history" >Route</a></li>
						<li><a href="#" id="" >Friend</a></li>
						<li><a href="#" id="" >History</a></li>
					
					</ul>
				</div>
			</div>
		</div>	
		
<script src="./js/bootstrap.js"></script>		
<script language="javascript">
	var timeuse = 0;
	var timeinterval = 0;
	var timeall = 0;
	var lap_array = new Array();



	function millisectotime(mill)
	{
		var hour = Math.floor(timeinterval/36000);
		var min = Math.floor(timeinterval/600)%60;
		var sec = Math.floor(timeinterval/10)%60;

		if (hour < 10) hour = "0" + hour;
		if (min < 10) min = "0" + min;
		if (sec < 10) sec = "0" + sec;

		return (hour + ":" + min + ":" + sec  );


	}

	function TimerOK()
	{	
		timeinterval = timeinterval + 1;


		$('#timer').html(millisectotime(timeinterval));

		localStorage.setItem('timer_current',timeinterval);
		localStorage.setItem('timer_history',JSON.stringify(lap_array));

		if(timeuse == 1)
		{
			setTimeout('TimerOK()', 100);
		}
	}

	function millisectime(mills)
	{
		var hour = Math.floor(timeall/36000);
		var min = Math.floor(timeall/600)%60;
		var sec = Math.floor(timeall/10)%60;

		if (hour < 10) hour = "0" + hour;
		if (min < 10) min = "0" + min;
		if (sec < 10) sec = "0" + sec;

		return (hour + ":" + min + ":" + sec);


	}

	function ResetTime()
	{	
			timeuse = 0;
			timeinterval = 0;
			$('#timer').html(millisectotime(timeinterval));
	}

	function Timeall()
	{

	timeall = timeall + timeinterval;
	$('#timeall').html(millisectime(timeall));

	}

	$(document).ready(function() { // On page load completed do it function.
		var status = 0;
		var btntoggle = 0;
		var btntoggles  =0;
			//if(localStorage.getItem('time_all'))
			//timeall = parsInt(localStorage.getItem('time_all'))
		
		if(localStorage.getItem('timer_history') && localStorage.getItem('timer_current')){
			lap_array = JSON.parse(localStorage.getItem('timer_history'));
			timeinterval = parseInt(localStorage.getItem('timer_current'));
		}
			//var timeallstring = "";
			var buildstring = "";

			for(var i = 0; i < lap_array.length;i++)
			{
				buildstring =  '<h1 style="font-size:40px">' + (i+1) + ' - ' + lap_array[i] + '</h1>' + buildstring ;			
			}
		//$('#mytime').html(buildstring);
		$('#mytime2').html(buildstring);
		//$('#timeall').html(timeallstring);
		$('#timer').html(millisectotime(timeinterval));
	/*
		$("#datablock02").hide();

		$('#stpmode').on('click',function(){
			$('#datacon').animate({left:0},500);
			$('#slidemenu').animate({left:-200},500);
			$("#datablock02").hide(500,'swing');
			$("#datablock01").show(500);
		status = 0;
		});

		$('#historymode').on('click',function(){
			$('#datacon').animate({left:0},500);
			$('#slidemenu').animate({left:-200},500);
			$("#datablock01").hide(500);
			$("#datablock02").show(500);
			status = 0;
		});
	
		$('#sumtime').on('click',function(){
			$('#datacon').animate({left:0},500);
			$('#slidemenu').animate({left:-200},500);
			$("#datablock01").hide(500);
			$("#datablock02").hide(500);
			status = 0;
		});
	
		$('#btnslide').on('click',function(){
			if (status == 0)
			{
				$('#datacon').animate({left:200},500);
				$('#slidemenu').animate({left:0},500);
				status = 1;
			}
			else
			{
				$('#datacon').animate({left:0},500);
				$('#slidemenu').animate({left:-200},500);
				status = 0;
			}
		});*/
	
		$('#btn-delall').on('click',function(){
			localStorage.removeItem('timer_current');
			localStorage.removeItem('timer_history');
			timeinterval = 0;
			$('#timer').html(millisectotime(timeinterval));
			$('#mytime').html("");
			$('#mytime2').html("");
			lap_array.length = 0;

		});
	
	
	/*$('#btn-pause').on('click',function(){
		if (btntoggle == 1) //lap
		{
			lap_array.push(millisectotime(timeinterval));
			var buildstring = "";
			for(var i = 0; i < lap_array.length;i++)
			{
				buildstring =  '<h1 style="font-size:30px">' + (i+1) + ' - ' + lap_array[i] + '</h1>' + buildstring ;
				

			}
			$('#mytime').html(buildstring);
			$('#mytime2').html(buildstring);
		}
		else
		{
			timeinterval = 0;
			$('#timer').html(millisectotime(timeinterval));
		}

	});*/
	
		$('#btn-pause').on('click',function(){
		if (btntoggles == 0)
			{
			$('#btn-pause').removeClass("btn-inverse");
			$('#btn-pause').addClass("btn-success");
			$('#btn-pause').html('Start');
			timeuse = 0;
			btntoggles =1;
			}
		else
			{
			$('#btn-pause').removeClass("btn-success");
			$('#btn-pause').addClass("btn-inverse");
			$('#btn-pause').html('Pause');
			timeuse = 1;
			TimerOK();
			btntoggles =0;
			}
		});
	
	/*$('#btn-pause').on('click',function(){
		
			timeinterval = 0;
			$('#timer').html(millisectotime(timeinterval));
		});*/
	
		$('#btn-start-stop').on('click',function(){
			if (btntoggle == 0)
			{
				$('#btn-start-stop').removeClass("btn-success");
				$('#btn-start-stop').addClass("btn-danger");
				$('#btn-start-stop').html('Stop');

				$('#btn-pause').removeClass("btn-primary");
				$('#btn-pause').addClass("btn-inverse");
				$('#btn-pause').html('Pause');

				timeuse = 1;			
				TimerOK();
				btntoggle = 1;
			}
			else
			{
				$('#btn-start-stop').removeClass("btn-danger");
				$('#btn-start-stop').addClass("btn-success");
				$('#btn-start-stop').html('Start');
			
				$('#btn-pause').removeClass("btn-success");
				$('#btn-pause').addClass("btn-inverse");
				$('#btn-pause').html('Pause');
				//timeuse = 0;
				btntoggle = 0;
				Timeall();
			
				lap_array.push(millisectotime(timeinterval));
				var buildstring = "";
				for(var i = 0; i < lap_array.length;i++)
				{
					buildstring =  '<h1 style="font-size:30px">' + (i+1) + ' - ' + lap_array[i] + '</h1>' + buildstring ;
			
				}
			
				$('#mytime2').html(buildstring);
				ResetTime();
			}

		});


	});


</script>
		</body>
</html>
